See **[[ReleaseNotes]]** for bugs fixed in previous releases.

= Changes since 3.0.2 =

Since 3.1, Mercurial commands are run in separate
[[http://mercurial.selenic.com/wiki/CommandServer|command server]] process.
It generally contributes to reliablity, but if you have a faulty extension
or a Python hook, it can corrupt the communication channel between TortoiseHg
and the command server.

If you see an error message like "cmdserver: timeout while reading...",
[[BugReport|please report it]] with the list of enabled extensions.

== Bug Fixes ==

* filectxactions: redesign visualDiffRevs to show diff between baseRev and rev \\
  (fixes #2313 - diff selected file revisions not working after move/rename)
* grep, status: use built-in drag-and-drop infrastructure
* postreview: correctly set parent of first selected revision (fixes #3538)
* repofilter: do no run revset query by focus out during history completion
* repofilter: do not steal focus when window is restored from minimized state
* repomodel: render description column without using HTMLDelegate \\
  (fixes #1590 - description column contents aligned 1px upper)
* run: continue without fork if new process can't be spawned (fixes #1949, #3800)
* run: promote rev to common annotate/log option (fixes #3799)
* workbench: do not change window icon (closes #3737)

command runner:

* cmdcore: enable command-server client by default in 3.1, fixes:
** #3343 - Blackbox extension not working when using hg from within TortoiseHg
** #1661 - "abort: Interrupted system" call during push with subrepos
** #2071 - crash when pushing with mercurial_keyring
** #2614 - `util.hgexecutable()` returns wrong path
** 074fd0fde0b6 - worker.py of Mercurial 2.6 only works in main thread
** #3370 - Workbench UI getting dispresponsive on certain operations
** #484 - Can't update to any revision (SVN subrepo)
** #788 - Can't use git repo
** #3637 - Redirect hook stdout, stderr to Output log
** #3670 - WindowsError 6 in pipe decode/encode filter

commit/status widget:

* commit: do not bulk-add unknown files when all selected files are largefiles
* commit, filectxactions: escape paths prior to command execution \\
  (fixes #2108 - files with some special names can't be added or commited)
* commit: take "autoinc" list as glob pattern again
* filectxactions: make "copy patch" generate diff between base and target revs
* repowatcher: invalidate cache if dirstate file is modified \\
  (fixes #3647 - file renaming inconsistencies)
* wctxactions: delegate "file history" action to filectxactions \\
  (fixes #2591 - No shortcut for "File history" command on files in Working
  Directory)
* wctxcleaner: invalidate changelog on each check of dirstate \\
  (fixes #3826 - commit do not work properly in the merge dialog)
* wctxactions: make visual diff compare to base revision, add "diff local" in
  place \\
  (fixes #2001 - diff does not work on MQ patches)
* wctxactions: reimplement by using command APIs, fixes:
** #1347 - Add support for pre-<command> and post-<command> hooks
** #2217 - Adding files to source control in the separate thread
** #1953 - largefiles treated wrong when added by tortoise contextmenu-entry
   "add large..."

high dpi issues:

* graphdelegate: update row height to actual value prior to painting \\
  (refs #3690)
* widgets: use small icon size defined by platform style (fixes #3690)

obsolete changeset:

* repowidget: switch visibility of hidden changesets globally \\
  (fixes #3735 - obosoleted changeset appears as "Child:" field unexpectedly)
* thgrepo: start with filtered repo because it is the default of Mercurial
* repoagent: append --hidden option while hidden changesets are visible

== Improvements ==

* blockmatcher: improve visibility of narrow markers
* filelog: export {{{thg filelog [-r REV] [--compare] FILE}}} command
* fileview: remember chunk selection on view mode switch
* mergetools: port gvimdiff from Mercurial's mergetools.hgrc
* repowidget: replace pseudo "incoming()" filter by "bundle()" (refs #3535)
* repowidget: run "Export Diff" and "Copy Patch" in command process for stability
* revset: run query in command process for stability
* searchtoolbar: make next/prev shortcuts available in owner widget (fixes #3819)
* toolbars: use toolbar icon size defined by QApplication.style() except on Mac
  (see 8d6212194e21 for details)

graph:

* graph: implement family line feature (see 891146f5a9bb for details)

== Installer ==

----

== Bug Fixes in Third-party Modules ==

Pygments (unreleased):
* [[https://bitbucket.org/birkenfeld/pygments-main/issue/891/|PrologLexer may freeze with triple backslashes]]

OpenSSL 1.0.1g:
* #3702 - Client Heartbleed vulnerability (possibly with libsvn_ra-1.dll)

QScintilla 2.8:
* Input methods are now properly supported

QScintilla 2.8.1:
* #3573 - Commit message input does not permit all unicode characters

Qt 4.8.6:
* #2300 - Workbench always opens on primary monitor when maximized

----

Random builds of the stable branch can be found at
**[[http://bitbucket.org/tortoisehg/thg-winbuild/downloads/|thg-winbuild]]**
